<div class="user-background">
    <div class="user-container">
        <app-top-bar [user]="currentUser"></app-top-bar>

        <div class="dashboard-container">
            <div class="left-panel">
                <h2>Witaj, {{ currentUser?.name }}!</h2>
                <p class="panel-title">Panel klienta</p>
            </div>

            <div class="right-panel">
                <div class="membership-top-card">
                <mat-icon class="membership-icon">credit_card</mat-icon>
                <span class="membership-name">{{ currentUser?.activeSubscription != null ? currentUser?.activeSubscription.name : "Brak karnetu" }}</span>
                </div>

            </div>
        </div>

        <mat-divider></mat-divider>

        <div class="info-cards">
            <mat-card class="info-card-clickable" (click)="onCurrentSubscriptionClick()">
                <div class="card-left">
                    <p class="card-title">Aktywny karnet</p>
                    <p class="card-name">{{ currentUser?.activeSubscription != null ? currentUser?.activeSubscription.name : "Brak karnetu" }}</p>
                    <p class="card-date">{{ currentUser?.subscriptionExpireDate ? "Aktywny do: " + translateDate(currentUser?.subscriptionExpireDate) : "" }}</p>
                </div>
                <div class="card-right">
                    <mat-icon class="card-icon">credit_card</mat-icon>
                </div>
            </mat-card>

            <mat-card class="info-card">
                <div class="card-left">
                    <p class="card-title">Dostępne treningi</p>
                    <p class="card-number">{{ availableTrainings.length }}</p>
                    <p class="card-note">W wybranym miesiącu</p>
                </div>
                <div class="card-right">
                    <mat-icon class="card-icon">calendar_today</mat-icon>
                </div>
            </mat-card>

            <mat-card class="info-card">
                <div class="card-left">
                    <p class="card-title">Zapisane treningi</p>
                    <p class="card-number">{{ participatingTrainings.length }}</p>
                    <p class="card-next">Nadchodzący trening: {{ closestTrainingTitle }}</p>
                </div>
                <div class="card-right">
                    <mat-icon class="card-icon">fitness_center</mat-icon>
                </div>
            </mat-card>
        </div>

        <div class="user-tabs-container">
            <mat-tab-group>
                <mat-tab label="Karnety">
                    <div class="tab-content">

                        <div class="membership-cards-container">
                            <mat-card class="membership-card" *ngFor="let membership of memberships">
                                <div>
                                    <h3 class="card-title">{{ membership.name }}</h3>
                                <p class="card-description">{{ membership.description }}</p>
                                <p class="card-price">{{ membership.amount }} PLN</p>
                                <ul class="card-features">
                                    <li *ngFor="let detail of membership.details">
                                        <mat-icon class="feature-icon">check_circle</mat-icon> {{ detail.description }}
                                    </li>
                                </ul>
                                </div>
                                <div style="display: flex; width: 100%; justify-content: center; margin-top: auto;">
                                    <button mat-raised-button color="primary" class="buy-button">Kup karnet</button>
                                </div>
                            </mat-card>
                        </div>

                    </div>
                </mat-tab>

                <mat-tab label="Dostępne treningi">
                    <div class="tab-content">
                        <div class="available-trainings-container">
                            <div class="date-table-container">
                                <button mat-icon-button (click)="decreaseMonth()"><mat-icon>arrow_left</mat-icon></button>
                                <div class="date-container">
                                    {{ translateMonth(currentMonth) }} {{ currentYear }}
                                </div>
                                <button mat-icon-button (click)="increaseMonth()"><mat-icon>arrow_right</mat-icon></button>
                            </div>
                            <div class="available-trainings-list">
                                <h1 *ngIf="availableTrainings.length == 0" style="color: gray; text-align: center;">Brak treningów</h1>
                                <mat-card class="training-item" *ngFor="let training of availableTrainings">
                                    <div class="training-info">
                                        <p class="training-details">
                                            <strong>Start:</strong> {{ translateDate(training.startDate) }}
                                        </p>

                                        <p class="training-details">
                                            <strong>Koniec:</strong> {{ translateDate(training.endDate) }}
                                        </p>

                                        <p class="training-details">
                                            <strong>Trener:</strong> {{ training.trainer.name }}
                                        </p>

                                        <p class="training-details">
                                            <strong>Uczestnicy:</strong> {{ training.participants.length }} / {{ training.limit }}
                                        </p>
                                    </div>

                                    <div class="training-info">
                                        <h2 class="training-name">{{ training.title }}</h2>

                                        <p class="training-details" style="text-align: center;">{{ training.description }}</p>
                                    </div>

                                    <button mat-raised-button color="primary" class="join-button" [disabled]="training.participates || training.participants.length >= training.limit" (click)="onParticipate(training.id)">
                                        Zapisz się
                                    </button>
                                </mat-card>
                            </div>
                        </div>
                    </div>
                </mat-tab>

                <mat-tab label="Moje treningi">
                    <div class="tab-content">
                        <div class="available-trainings-list">
                            <h1 *ngIf="participatingTrainings.length == 0" style="color: gray; text-align: center;">Brak treningów</h1>
                            <mat-card class="training-item" *ngFor="let training of participatingTrainings">
                                <div class="training-info">
                                    <p class="training-details">
                                        <strong>Start:</strong> {{ translateDate(training.startDate) }}
                                    </p>

                                    <p class="training-details">
                                        <strong>Koniec:</strong> {{ translateDate(training.endDate) }}
                                    </p>

                                    <p class="training-details">
                                        <strong>Trener:</strong> {{ training.trainer.name }}
                                    </p>

                                    <p class="training-details">
                                        <strong>Uczestnicy:</strong> {{ training.participants.length }} / {{ training.limit }}
                                    </p>
                                </div>

                                <div class="training-info">
                                    <h2 class="training-name">{{ training.title }}</h2>

                                    <p class="training-details" style="text-align: center;">{{ training.description }}</p>
                                </div>

                                <button mat-raised-button color="primary" class="join-button" (click)="onParticipateRemove(training.id)">
                                    Wypisz się
                                </button>
                            </mat-card>
                        </div>
                    </div>
                </mat-tab>
            </mat-tab-group>
        </div>

    </div>
</div>